!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}({18:function(e,t,n){"use strict";n.r(t);var i=window.navigator.userAgent,r=window.LizhiJSBridge,o={bridge:r,isApp:!!(i.indexOf("LizhiFM")>=0||r)};var u={state:o,update:function(e,t){o[e]=t}},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},f={},d=0,l=function(){function e(){s(this,e)}return a(e,[{key:"on",value:function(e,t){return e in f||(f[e]={}),f[e][++d]=t,d}},{key:"off",value:function(e,t){e in f&&t in f[e]&&delete f[e][t]}},{key:"emit",value:function(e){if(e in f){for(var t=f[e],n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o in t)t[o].apply(null,i)}}},{key:"once",value:function(e,t){var n=this.on,i=this.off,r=n(e,function(n){t(n),i(e,r)});return r}}]),e}(),p=function(e){return function(e){return function(t,n,i){return i?e(t,n,i):new Promise(function(i,r){e(t,n,function(e){return i(e)})})}}};var g=u.state,v=u.update,y={call:function(e,t,n){g.bridge.call(e,t,n)},on:function(e,t){g.bridge.on(e,t)}};function m(){var e=this,t=e.option,n=t.url,i=t.eventList;e.emit("bridge:ready",g.bridge),i.map(function(t){y.on(t,function(n){e.emit(t,n)})}),n?function(e,t){var n=this,i=[];y.call("getUdid",{},function(r){if(i.push(r),"success"===r.status){var o=r.udid;n.emit("sign",{status:"success",data:{step:"getUdid",ret:r,rets:i},msg:"success"}),function(){var e;(e=window._LIZHIJS).ajax.apply(e,arguments)}({url:e,data:{udid:o},dataType:"json",success:function(e){i.push(e),0===e.rCode?(n.emit("sign",{status:"success",data:{step:"getSign",ret:e,rets:i},msg:"success"}),y.call("requestVerifySign",e.data,function(e){i.push(e),"success"===e.status?(n.emit("sign",{status:"success",data:{step:"requestVerifySign",ret:e,rets:i},msg:"success"}),n.once("verifySignFinish",function(e){i.push(e),"success"===e.status?(n.emit("sign",{status:"success",data:{step:"verifySignFinish",ret:e,rets:i},msg:"success"}),t(i)):n.emit("sign",{status:"failed",data:{step:"verifySignFinish",ret:e,rets:i},msg:"failed"})})):n.emit("sign",{status:"failed",data:{step:"requestVerifySign",ret:e,rets:i},msg:"failed"})})):n.emit("sign",{status:"failed",data:{step:"getSign",ret:e,rets:i},msg:"failed"})},error:function(e){i.push(e),n.emit("sign",{status:"failed",data:{step:"getSign",ret:e,rets:i},msg:"failed"})}})}else n.emit("sign",{status:"failed",data:{step:"getUdid",ret:r,rets:i},msg:"failed"})})}.call(e,n,function(t){e.isReady=!0,e.emit("signed",t),e.emit("ready")}):(e.isReady=!0,e.emit("ready"))}var b=new(function(e){function t(){s(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.isReady=!1,e.isApp=u.state.isApp,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),a(t,[{key:"config",value:function(e){var t=e.debug,n=void 0!==t&&t,i=e.url,r=void 0===i?"":i,o=e.apiList,u=void 0===o?[]:o,s=e.eventList,a=void 0===s?[]:s,c=e.apiMiddlewares,f=void 0===c?[]:c,d=e.eventMiddlewares,l=void 0===d?[]:d,b=e.other,h=void 0===b?{}:b,w=this;w.option={debug:n,url:r,apiList:u,eventList:a,apiMiddlewares:f,eventMiddlewares:l,other:h},r&&![!1].concat(a).reduce(function(e,t){return e||"verifySignFinish"===t})&&a.push("verifySignFinish");var S,j,O,_=[function(e){return function(t){return function(n,i,r){e.isApp&&t(n,i,r)}}},function(e){return function(t){return function(n,i,r){t(n,i,function(t){e.option.debug&&e.alt({api:n,ret:t}),r(t)})}}}].concat(f,[p]),L=[function(e){return function(t){return function(n,i){t(n,function(t){e.option.debug&&e.alt({event:n,ret:t}),i(t)})}}}].concat(l);y.call=(S=w,j=y.call,O=j,_.map(function(e){O=e(S)(O)}),O),y.on=function(e,t,n){var i=t;return n.map(function(t){i=t(e)(i)}),i}(w,y.on,L),u.map(function(e){w[e]=function(t,n){return y.call(e,t,n)}}),function(){var e=this;g.bridge?m.call(e):document.addEventListener("LizhiJSBridgeReady",function(){v("bridge",window.LizhiJSBridge),m.call(e)},!1)}.call(w)}},{key:"ready",value:function(e){this.isReady?e():this.on("ready",function(){e()})}},{key:"alt",value:function(e){window.alert(JSON.stringify(e))}},{key:"log",value:function(){var e;g.isApp&&g.bridge&&(e=g.bridge).log.apply(e,arguments)}}]),t}());n.d(t,"getLzUserName",function(){return h}),n.d(t,"saveImage",function(){return w}),b.config({debug:!1,url:"//h5security.lizhi.fm/jsBridgeConfig/get",apiList:["getSessionUser","saveImage"],eventList:[],apiMiddlewares:[],eventMiddlewares:[]});var h=function(e){b.ready(function(){b.getSessionUser().then(function(t){e(t.name)})})},w=function(e,t){b.ready(function(){b.saveImage({image:e}).then(t)})}}})});
//# sourceMappingURL=lz.js.map